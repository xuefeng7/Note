//provide endpoints for user signin and signup

module.exports = function (){
	var express = require('express');
	var app = express();

	// Signs up a new user
  app.post('/signup_submit/', function(req, res) {
  	//username & password in section one
    var username = req.body.email;
    var password = req.body.password;
    //basic perosnal info in section two
    var first_name = req.body.first_name;
    var last_name = req.body.last_name;
    //profile image
    //var profile_pic = req.body.profile_pic;
    var profile_base = "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";
    var imgFile = new Parse.File("default.png", { base64: profile_base });

    var user = new Parse.User();
    user.set('username', username);
    user.set('password', password);
    user.set('email', username); //username = email
    user.set('first_name',first_name);
    user.set('last_name', last_name);
    user.set('profile',imgFile);
    
    user.signUp().then(function(user) {
      console.log('a user just signed up');
      res.send('succeed');
      return;
    }, function(error) {
      // Show the error message and let the user try again
      console.log('failed sign up a user with error',error);
      res.send(error.message);
      return;
    });
  });

  // Logs in the user endpoint
  app.post('/log_in/', function(req, res) {
    
      var username = req.body.email;
      var password = req.body.password;

      Parse.User.logIn(username, password, {
        success: function(user) {
          res.send(user);
          return;
        },
        error: function(user, error) {
          res.send(error.message);
          return;
        }

      });
 
  });

    // Logs out the user
  app.post('/logout', function(req, res) {
    Parse.User.logOut();
    res.redirect('/');
  });

  return app;


}();