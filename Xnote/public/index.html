<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Xnote</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Plugin CSS -->
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/creative.css" type="text/css">
    <link href="css/stylish-portfolio.css" rel="stylesheet">
    <!-- shortcut icon -->
    <link rel="shortcut icon" href="https://maxcdn.icons8.com/Color/PNG/24/Messaging/note-24.png">
    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css"> 
    <!-- custom alert box -->
    <script src="sweetalert/dist/sweetalert.min.js"></script> 
    <link rel="stylesheet" type="text/css" href="sweetalert/dist/sweetalert.css">

    <link rel="stylesheet" href="css/style.css" media="screen" type="text/css" />

    <link href="css/override.css" rel="stylesheet">
    <link href="css/bootstrap-social.css" rel="stylesheet" >
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="js/spinner.js"></script>
     <!-- load Parse JS SDK  -->
    <script src="//www.parsecdn.com/js/parse-1.6.7.min.js"></script> 
    <script>Parse.initialize("k1i3e6JBdkUgptmp2oqoiJkBOAobNTR6mCTe7NnU", "SqhJL7a5UPYhdNaRChWTGspWuapBjqYOlqX99wGy");
    </script> 

</head>

<body>

    <!-- Navigation -->
    <nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#page-top">Welcome</a>
            
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li class="page-scroll" id="shopNote">
                        <a href="allNotes.html">Shop Notes</a>
                    </li>
                    <li class="page-scroll" id="myNote">
                        <a href="myNotes.html">My Notes</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#about">About</a>
                    </li>
                    <li class="page-scroll">
                        <a href="#services">Services</a>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-left">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <img class = "img-circle" src = "" id = "profileImg" />
                    </li>
                    <li class="page-scroll">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle js-activated" id = "userName" data-hover="dropdown" data-toggle="dropdown"></a>
                            <ul class="dropdown-menu">
                                <li> <!-- <a href="profile.html">Profile</a> -->
                                <button type="button" class="btn btn-dark btn-lg" data-toggle="modal" id="profileButton">Profile</button>
                                </li>
                                <li>  <!--<a href="#">Log out</a> -->
                                    <button type="button" class="btn btn-dark btn-lg" data-toggle="modal" id="logoutButton">Log out</button>
                                </li>
                            </ul>
                        </li>   
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Navigation 
    <a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
    <nav id="sidebar-wrapper">
        <ul class="sidebar-nav">
            <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
            <li class="sidebar-brand">
                <a href="#top"  onclick = $("#menu-close").click(); >Xnote</a>
            </li>
            <li>
                <a href="#top" onclick = $("#menu-close").click(); >Home</a>
            </li>
            <li>
                <a href="#about" onclick = $("#menu-close").click(); >Log in</a>
            </li>
            <li>
                <a href="#services" onclick = $("#menu-close").click(); >Abount Us</a>
            </li>
        </ul>
    </nav>  -->
    <!-- scripts -->

    <!-- Header -->
    
    <header id="top" class="header">
       <div id="particles-js"></div>
        <div class="text-vertical-center">
                    <h1 style="color:white" style="font-family:sans-serif" style="font-size:80">Xnote</h1>
                    <h3 style="color:white" style="font-family:sans-serif" style="font-size:40">Excellent notes right in your palm</h3>
                    <br>
                    <button type="button" class="btn btn-dark btn-lg" data-toggle="modal" data-target="#LoginForm" id="loginButton">Sign In</button>

                    <div class="modal fade" id="LoginForm">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label=""><span>&times;</span></button>
                                    <h4 class="modal-title">Log in</h4>
                                </div>
                                <div class="modal-body">
                                    <form class="form-horizontal" action="">
                                    <div class="form-group">
                                        <label class="col-md-4 col-md-offset-1">Email:</label>
                                        <div class="col-md-5">
                                            <input type="email" class="form-control input-sm" id="loginEmail" value="" placeholder="fill in your email address" >
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-md-4 col-md-offset-1">Password:</label>
                                        <div class="col-md-5">
                                            <input type="password" class="form-control input-sm" value="" id="loginPassword" placeholder="password here" >
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <div class="col-md-2 col-md-offset-5">
                                            <button type="submit" class="btn btn-success" id="loginUser">Sign In</button>  
                                        </div>
                                    </div>

                                    </form> 
                                </div>
                                <div class="modal-footer"></div>
                            </div>
                        </div>
                    </div>
            <!-- //<a href="loginPage.html" class="btn btn-dark btn-lg">Log in</a> -->
            <a href="signUp.html" class="btn btn-dark btn-lg" id="registerButton">Sign Up</a>
            <!-- social plug in -->
            <h3 id="socials">
                <a class="btn btn-social-icon btn-facebook" id="facebookLogin">
                    <span class="fa fa-facebook"></span>
                </a>
                <a class="btn btn-social-icon btn-twitter">
                    <span class="fa fa-twitter"></span>
                </a>
                <a class="btn btn-social-icon btn-linkedin">
                    <span class="fa fa-linkedin"></span>
                </a>
                <a class="btn btn-social-icon btn-google">
                    <span class="fa fa-google"></span>
                </a>
                <a class="btn btn-social-icon btn-github">
                    <span class="fa fa-github"></span>
                </a>
            </h3>
            </div>
    
    <script src="js/particles.js"></script>
    <script src="js/particles-app.js"></script>
    </header>

    <section class="no-padding" id="portfolio">
        <div class="container-fluid">
            <div class="row no-gutter">
                <div class="col-lg-4 col-sm-6">
                    <a href="allNotes.html#Computer Science" class="portfolio-box">
                        <img src="img/portfolio/1.jpg" class="img-responsive" alt="">
                        <div class="portfolio-box-caption">
                            <div class="portfolio-box-caption-content">
                                <div class="project-category text-faded">
                                    Computer Science
                                </div>
                                <div class="project-name">
                                    &lt;/hello world &gt;
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-4 col-sm-6">
                    <a href="allNotes.html#Mathematics" class="portfolio-box">
                        <img src="img/portfolio/2.jpg" class="img-responsive" alt="">
                        <div class="portfolio-box-caption">
                            <div class="portfolio-box-caption-content">
                                <div class="project-category text-faded">
                                    Mathematics
                                </div>
                                <div class="project-name">
                                    f(n) = f(n-1) + f(n-2)
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-4 col-sm-6">
                    <a href="allNotes.html#Physics" class="portfolio-box">
                        <img src="img/portfolio/3.jpg" class="img-responsive" alt="">
                        <div class="portfolio-box-caption">
                            <div class="portfolio-box-caption-content">
                                <div class="project-category text-faded">
                                    Physics
                                </div>
                                <div class="project-name">
                                    E = mc^2
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-4 col-sm-6">
                    <a href="allNotes.html#Chemistry" class="portfolio-box">
                        <img src="img/portfolio/4.jpg" class="img-responsive" alt="">
                        <div class="portfolio-box-caption">
                            <div class="portfolio-box-caption-content">
                                <div class="project-category text-faded">
                                    Chemistry
                                </div>
                                <div class="project-name">
                                    2H + O = H2O
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-4 col-sm-6">
                    <a href="allNotes.html#Chinese" class="portfolio-box">
                        <img src="img/portfolio/5.jpg" class="img-responsive" alt="">
                        <div class="portfolio-box-caption">
                            <div class="portfolio-box-caption-content">
                                <div class="project-category text-faded">
                                    Chinese
                                </div>
                                <div class="project-name">
                                    您好
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-4 col-sm-6">
                    <a href="allNotes.html#Philosophy" class="portfolio-box">
                        <img src="img/portfolio/6.jpg" class="img-responsive" alt="">
                        <div class="portfolio-box-caption">
                            <div class="portfolio-box-caption-content">
                                <div class="project-category text-faded">
                                    Philosophy
                                </div>
                                <div class="project-name">
                                    where did I come from? Where do I go?
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>
<!-- About -->
    <section id="about" class="about bg-info">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 style="font-family:sans-serif">Share and enjoy the perfect notes in our Xnote community</h2>
                    <p style="font-family:sans-serif" style="font-size:30">10,000+ notes from around 100 subjects</p>
                </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container -->
    </section>

    <!-- Services -->
    <!-- The circle icons use Font Awesome's stacked icon classes. For more information, visit http://fontawesome.io/examples/ -->
 <!-- Services Section -->
    <section id="services">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Services</h2>
                    <h3 class="section-subheading text-muted">Enlightening and Comprehensive</h3>
                </div>
            </div>
            <div class="row text-center">
                <div class="col-md-4">
                    <span class="fa-stack fa-4x">
                        <i class="fa fa-circle fa-stack-2x text-primary"></i>
                        <i class="fa fa-cloud fa-stack-1x fa-inverse"></i>
                    </span>
                    <h4 class="service-heading">Note Everywhere</h4>
                    <p class="text-muted">Purchased notes can be accessed in you favorite devices. Our secured cloud storage will always keep your notes safe, and our 7/24 customer services will always be ready to offer warm helps.</p>
                </div>
                <div class="col-md-4">
                    <span class="fa-stack fa-4x">
                        <i class="fa fa-circle fa-stack-2x text-primary"></i>
                        <i class="fa fa-line-chart fa-stack-1x fa-inverse"></i>
                    </span>
                    <h4 class="service-heading">Read Notes</h4>
                    <p class="text-muted">More than 100,000 notes in almost every collegiate subjects, we promise that you will always find the note right for you. Our goal is helping our customers to Ace their studies. </p>
                </div>
                <div class="col-md-4">
                    <span class="fa-stack fa-4x">
                        <i class="fa fa-circle fa-stack-2x text-primary"></i>
                        <i class="fa fa-exchange fa-stack-1x fa-inverse"></i>
                    </span>
                    <h4 class="service-heading">Create Notes</h4>
                    <p class="text-muted">You can always share your high quality notes to Xnote community with rewards. Helping others and earning credits, your contribution means a lot to us. We promise you will enjoy.</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <span class="copyright">Copyright &copy; Xnote, Inc 2015</span>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline social-buttons">
                        <li><a href="#"><i class="fa fa-twitter"></i></a>
                        </li>
                        <li><a href="#"><i class="fa fa-facebook"></i></a>
                        </li>
                        <li><a href="#"><i class="fa fa-linkedin"></i></a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <ul class="list-inline quicklinks">
                        <li><a href="#">Privacy Policy</a>
                        </li>
                        <li><a href="#">Terms of Use</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>


    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-hover-dropdown.js"></script>


    <!-- Custom Theme JavaScript -->
    
    <script type="text/javascript" src='js/fyll.js'></script>
    <script type="text/javascript" src='js/index.js'></script>

    <!-- Plugin JavaScript Navbar effect-->
    <script src="js/jquery.fittext.js"></script>
    <script src="js/creative.js"></script>

       <!-- log in -->
    <script type = "text/javascript">
    
    //force non-https request to https
    if (window.location.protocol != "https:") {
       window.location.href = "https:" + window.location.href.substring(window.location.protocol.length);
    }

    //spinner sample usage
    // var opts = {

    //     lines: 10,
    //     length: 0, // The length of each line
    //     color: '#fed136' // #rgb or #rrggbb
    // };
    // spinner_div = $('#top').get(0);
    // spinner = new Spinner(opts).spin(spinner_div);

    $(document).ready(function() {

      $.ajax({
        url: "/user?",
        type: "GET",
        success: function(data) {
                //check facebook user first
                if (data === 'failed') {
                   
                   console.log("fetch cached user failed.");
                   $("#userName").hide();
                   $("#profileImg").hide();
                   $("#myNote").hide();
                }
                else{
                   //has cached user 
                   $("#userName").html(data['first_name']+" "+data['last_name']);
                   $("#profileImg").attr('src',data['profile']['url']);
                   $("#loginButton").hide();
                   $("#registerButton").hide();
                   $("#socials").hide();
                }
            }
      }); 
      // user logging in handler
      $("#loginUser").click(function(event) {
        //prevent the default redirect event
        event.preventDefault(); 
        $.ajax({
            url: "/log_in/",
            type: "POST",
            dataType: "text",
            //encapuslate user sign up information
            data : {
                email: $("#loginEmail").val(),
                password: $("#loginPassword").val()
            },
            success: function(data) {
                
                //JSON string
                if (data[0] == '{') {
                    
                    window.location = '/'; //redirect
                
                }else{
                    //log in failed
                    swal("Sign In Failed", data);
                    console.log(data);
                }
            },
            error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
               swal("Something went wrong", msg);
            }
       
        });
      });
         //facebook log in
      $("#facebookLogin").click(function() {
        
        window.fbAsyncInit = function() {
            
            Parse.FacebookUtils.init({ // this line replaces FB.init({
              
              appId      : '1026993120692786', // Facebook App ID
              cookie     : true,  // enable cookies to allow Parse to access the session
              xfbml      : true,  // initialize Facebook social plugins on the page
              version    : 'v2.5' // point to the latest Facebook Graph API version
            
            });
            Parse.FacebookUtils.logIn("public_profile, email", {
            
              success: function(user) {
                    
                    if (!user.existed()) {
                      FB.api('/me', function(response) {
                          
                          user.set('first_name',response.first_name);
                          user.set('last_name',response.last_name);
                          user.set('email',response.email);
                          user.set('profile',response.picture);
                          //save user info
                          user.save(null, {
                            success: function(user) {
                                //facebook user info saved
                                //now redirect
                                window.location = '/';
                            }
                          });
                      });
                    } else {
                      
                      console.log("User logged in through Facebook!");
                      window.location = '/'; //redirect
                    }
                },
               
               error: function(user, error) {
                  console.log('facebook log in failed with error: '+ error.message);
                }
            });
         };
        (function(d, s, id){
        
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        
        }(document, 'script', 'facebook-jssdk'));
      }); 
        //  user log out  
        $("#logoutButton").click(function() {

            swal(
                {   
                    title: "Log out",   
                    text: "Are you sure to log out?",   
                    type: "warning",   
                    showCancelButton: true,   
                    confirmButtonColor: "#DD6B55",   
                    confirmButtonText: "Confirm",   
                    closeOnConfirm: false }, 
                    function(){   

                    $.ajax({
                        url: "/log_out/",
                        type: "POST",
                        success: function(data) {
                                
                                if (data === 'succeed') {
                                swal("Succeed", "Logged out successfully.", "success");
                                window.location = '/'; //redirect
                                }else{
                                console.log("user logged out");
                                }
                            }
                      });  
                    });
                         
            });
          // redirect botton to the user's profile page and need to check user? first before redirection
          $("#profileButton").click(function() {
          
          $.ajax({
            url: "/user?",
            type: "GET",
            success: function(data) {
                    
                    if (data === 'failed') {
                       console.log("fetch cached user failed. Not allow to go to userPage");
                    }else{
                        //move the browser to the userPage.html
                      console.log("User's session is valid, redirect");
                      window.location.replace("profile.html");
                    }
                }
          });
          });  
        
    });
    </script>

</body>

</html>